@startuml

title ブロック並べ状態遷移図

state ブロックまで移動 {
	WP移動中 : entry / 次のWPの角度に旋回
	WP移動中 : do / 移動 

	ライントレース中 : entry / ラインの向きに旋回する
	ライントレース中 : do / ラインに沿って移動する
	ライントレース中 : exit / 停止する

	WP捜索中 : do / 旋回する

	[*] --> WP移動中

	WP移動中--> ライントレース中 : 最終WP到達
	WP移動中 --> WP移動中 : 途中WP到達

	WP移動中 --> WP捜索中 : WP座標到達後、ラインを認識しない
	WP捜索中 --> WP移動中 : 途中WP到達
	WP捜索中 --> ライントレース中 : 最終WP到達

	ライントレース中 -r-> [*] : ポリゴンブロック置き場到達
}

state ブロックを運搬{
	WP移動中_ : entry / 次のWPの角度に旋回
	WP移動中_ : do / 自己位置推定結果を補正しながら移動

	ライントレース中_ : entry / ラインの向きに旋回する
	ライントレース中_ : do / ラインに沿って移動する
	ライントレース中_ : exit / 停止する

	WP捜索中_ : do / 旋回する

	[*] --> WP移動中_

	WP移動中_ --> ライントレース中_ : 最終WP到達
	WP移動中_ --> WP移動中_ : 途中WP到達

	WP移動中_ --> WP捜索中_ : WP座標到達後、ラインを認識しない
	WP捜索中_ --> WP移動中_ : 途中WP到達
	WP捜索中_ --> ライントレース中_ : 最終WP到達


	ライントレース中_ -r-> [*] : ポリゴンブロック置き場到達
}

[*] --> ブロックまで移動

ブロックまで移動 -ri-> ブロックを運搬
ブロックを運搬 --> ブロックを離す

ブロックを離す --> ブロックまで移動 : 全ての運搬コマンドが完了していない場合
ブロックを離す --> [*] : 全ての運搬コマンドが完了した場合


@enduml